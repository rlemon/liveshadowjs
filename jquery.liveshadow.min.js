$.fn.liveShadow=function(a){var n=function(e,b,c,f){var k=1,l=1,g=5,h=[],d=4*Math.cos(c);c=4*Math.sin(c);for(var m=0;m<b/4;m++)k=m*d,l=m*c,g+=0.75,h.push(k+"px "+l+"px "+g+"px rgba("+f.r+","+f.g+","+f.b+","+(f.a-m/(b/4))+")");e.style[a.type+"Shadow"]=h.join(",")},p=function(a){a=a.replace(/#/,"");3===a.length&&(a=a.replace(/./g,"$&$&"));a=parseInt(a,16);return{r:a>>16,g:a>>8&255,b:a&255}},q=function(a,b){var c=0.3*a.r+0.59*a.g+0.11*a.b;return{r:c*b+a.r*(1-b)|0,g:c*b+a.g*(1-b)|0,b:c*b+a.b*(1-b)|0}},
r=function(e){var b="text"===a.type?"color":"backgroundColor";e=window.getComputedStyle(e)[b].match(/\d+/g).map(Number);return{r:e[0],g:e[1],b:e[2]}};a=$.extend({shadowLength:70,opacity:0.7,type:"box",color:null,distance:document.body.offsetWidth/4,angle:45,desaturate:0.1,invert:!1},a);"string"===typeof a.color&&(a.color=p(a.color));a.color&&a.color.a&&(a.opacity=a.color.a);a.constAngle=Math.PI/180*90;return this.each(function(){var e,b,c,f=this,k=function(a){e=f.offsetWidth/2;b=f.offsetHeight/2;
c=$(f).offset()},l=a.color||q(r(this),a.desaturate);k();n(f,a.shadowLength,a.constAngle-a.angle,$.extend({a:a.opacity},l));$(window).on("resize",k).on("mousemove touchmove",function(g){var h=c.left-g.clientX+e,d=c.top-g.clientY+b;g=a.constAngle-Math.atan2(h,d);d=Math.sqrt(h*h+d*d)+45;h=d<a.distance?d/a.distance*a.shadowLength:a.shadowLength;d=$.extend({a:d<a.distance?d/a.distance*a.opacity:a.opacity},l);console.log(c.left);a.invert&&(g*=-1);n(f,h,g,d)})})};